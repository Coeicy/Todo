<view class="container">
  <!-- ä»»åŠ¡ç­›é€‰æ  -->
  <view class="filter-bar">
    <view class="filter-item {{filter === 'done' ? 'active' : ''}}" 
          bindtap="setFilter" 
          data-type="done">
      å·²å®Œæˆ
    </view>
    <view class="filter-item {{filter === 'undone' ? 'active' : ''}}" 
          bindtap="setFilter" 
          data-type="undone">
      æœªå®Œæˆ
    </view>
    <view class="filter-item {{filter === 'quadrant' ? 'active' : ''}}" 
          bindtap="setFilter" 
          data-type="quadrant">
      è±¡é™
    </view>
  </view>

  <!-- ä»»åŠ¡åˆ—è¡¨ -->
  <view class="task-list" wx:if="{{filter !== 'quadrant'}}">
    <block wx:if="{{filteredTasks.length > 0}}">
      <!-- ä»»åŠ¡åˆ†ç»„ -->
      <block wx:for="{{taskGroups}}" wx:key="title">
        <view class="task-group" 
              wx:if="{{item.tasks.length > 0}}"
              data-group="{{item.title}}"
              bind:touchmove="onGroupDragOver"
              bind:touchend="onGroupDrop">
          <view class="group-title">{{item.title}}</view>
          <view class="task-card {{dragTask.id === task.id ? 'dragging' : ''}}"
                wx:for="{{item.tasks}}" 
                wx:key="id"
                wx:for-item="task"
                data-task="{{task}}"
                bind:longpress="onTaskDragStart"
                bind:touchend="onTaskDragEnd"
                catch:tap="goToDetail"
                data-id="{{task.id}}">
            <text class="task-title">{{task.title}}</text>
            <block wx:if="{{task.dueDate}}">
              <view class="task-time">
                <text class="due-date">æˆªæ­¢ï¼š{{task.dueDate}}</text>
                <text class="countdown {{task.isOverdue ? 'overdue' : ''}}">{{task.countdown}}</text>
              </view>
            </block>
          </view>
        </view>
      </block>
    </block>
    <!-- ç©ºçŠ¶æ€æç¤ºåªåœ¨æœªå®Œæˆè§†å›¾æ˜¾ç¤º -->
    <view wx:elif="{{filter === 'undone'}}" class="empty-tip">
      <text>æš‚æ— ä»»åŠ¡</text>
    </view>
  </view>

  <!-- è±¡é™è§†å›¾ -->
  <view class="quadrant-view" wx:if="{{filter === 'quadrant'}}">
    <view class="quadrant-grid">
      <!-- é‡è¦ä¸”ç´§æ€¥ -->
      <view class="quadrant-cell" 
            data-priority="3"
            bind:touchmove="onQuadrantDragOver"
            bind:touchend="onQuadrantDrop">
        <view class="quadrant-title priority-3">
          <text class="emoji">ğŸ˜¨</text>
          <text>é‡è¦ä¸”ç´§æ€¥</text>
        </view>
        <view class="task-list">
          <view class="task-card {{dragTask.id === task.id ? 'dragging' : ''}}"
                wx:for="{{quadrantTasks[3]}}" 
                wx:key="id"
                wx:for-item="task"
                data-task="{{task}}"
                bind:longpress="onTaskDragStart"
                bind:touchend="onTaskDragEnd"
                catch:tap="goToDetail">
            <text class="task-title">{{task.title}}</text>
            <block wx:if="{{task.dueDate}}">
              <view class="task-time">
                <text class="countdown">{{task.countdown}}</text>
              </view>
            </block>
          </view>
        </view>
      </view>

      <!-- é‡è¦ä¸ç´§æ€¥ -->
      <view class="quadrant-cell" 
            data-priority="2"
            bind:touchmove="onQuadrantDragOver"
            bind:touchend="onQuadrantDrop">
        <view class="quadrant-title priority-2">
          <text class="emoji">ğŸ˜Ÿ</text>
          <text>é‡è¦ä¸ç´§æ€¥</text>
        </view>
        <view class="task-list">
          <view class="task-card {{dragTask.id === task.id ? 'dragging' : ''}}"
                wx:for="{{quadrantTasks[2]}}" 
                wx:key="id"
                wx:for-item="task"
                data-task="{{task}}"
                bind:longpress="onTaskDragStart"
                bind:touchend="onTaskDragEnd"
                catch:tap="goToDetail">
            <text class="task-title">{{task.title}}</text>
            <block wx:if="{{task.dueDate}}">
              <view class="task-time">
                <text class="countdown">{{task.countdown}}</text>
              </view>
            </block>
          </view>
        </view>
      </view>

      <!-- ä¸é‡è¦ä½†ç´§æ€¥ -->
      <view class="quadrant-cell" 
            data-priority="1"
            bind:touchmove="onQuadrantDragOver"
            bind:touchend="onQuadrantDrop">
        <view class="quadrant-title priority-1">
          <text class="emoji">ğŸ™‚</text>
          <text>ä¸é‡è¦ä½†ç´§æ€¥</text>
        </view>
        <view class="task-list">
          <view class="task-card {{dragTask.id === task.id ? 'dragging' : ''}}"
                wx:for="{{quadrantTasks[1]}}" 
                wx:key="id"
                wx:for-item="task"
                data-task="{{task}}"
                bind:longpress="onTaskDragStart"
                bind:touchend="onTaskDragEnd"
                catch:tap="goToDetail">
            <text class="task-title">{{task.title}}</text>
            <block wx:if="{{task.dueDate}}">
              <view class="task-time">
                <text class="countdown">{{task.countdown}}</text>
              </view>
            </block>
          </view>
        </view>
      </view>

      <!-- ä¸é‡è¦ä¸ç´§æ€¥ -->
      <view class="quadrant-cell" 
            data-priority="0"
            bind:touchmove="onQuadrantDragOver"
            bind:touchend="onQuadrantDrop">
        <view class="quadrant-title priority-0">
          <text class="emoji">ğŸ˜</text>
          <text>ä¸é‡è¦ä¸ç´§æ€¥</text>
        </view>
        <view class="task-list">
          <view class="task-card {{dragTask.id === task.id ? 'dragging' : ''}}"
                wx:for="{{quadrantTasks[0]}}" 
                wx:key="id"
                wx:for-item="task"
                data-task="{{task}}"
                bind:longpress="onTaskDragStart"
                bind:touchend="onTaskDragEnd"
                catch:tap="goToDetail">
            <text class="task-title">{{task.title}}</text>
            <block wx:if="{{task.dueDate}}">
              <view class="task-time">
                <text class="countdown">{{task.countdown}}</text>
              </view>
            </block>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>

<!-- æ·»åŠ æŒ‰é’®æ”¾åœ¨å®¹å™¨å¤–éƒ¨ -->
<view class="add-btn" bindtap="goToAdd">
  <text>+</text>
</view> 