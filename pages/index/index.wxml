<view class="container">
  <!-- é¡¶éƒ¨å·¥å…·æ  -->
  <view class="toolbar">
    <view class="title">æˆ‘çš„ä»»åŠ¡</view>
    <view class="actions">
      <notification-icon 
        count="{{unreadCount}}"
        bindclick="onNotificationClick"
      />
      <view class="add-btn" bindtap="onAddTask">
        <text class="icon">+</text>
      </view>
    </view>
  </view>

  <!-- ä»»åŠ¡ç»Ÿè®¡ -->
  <view class="statistics">
    <view class="stat-item">
      <text class="stat-number">{{totalTasks}}</text>
      <text class="stat-label">æ€»ä»»åŠ¡</text>
    </view>
    <view class="stat-item">
      <text class="stat-number">{{completedTasks}}</text>
      <text class="stat-label">å·²å®Œæˆ</text>
    </view>
  </view>

  <!-- ä»»åŠ¡åˆ†ç±»æ ‡ç­¾ -->
  <view class="tabs">
    <view class="tab {{currentTab === 'today' ? 'active' : ''}}" bindtap="switchTab" data-tab="today">ä»Šæ—¥ä»»åŠ¡</view>
    <view class="tab {{currentTab === 'important' ? 'active' : ''}}" bindtap="switchTab" data-tab="important">é‡è¦ä»»åŠ¡</view>
  </view>

  <!-- ä½¿ç”¨ä»»åŠ¡åˆ—è¡¨ç»„ä»¶ -->
  <task-list 
    tasks="{{tasks}}"
    bind:click="viewTask"
    bind:statusChange="onTaskStatusChange"
    bind:importantChange="onTaskImportantChange"
  />

  <!-- æ·»åŠ ä»»åŠ¡æŒ‰é’® -->
  <view class="add-task-btn" bindtap="showAddTask">
    <text class="plus">+</text>
  </view>

  <!-- æ·»åŠ ä»»åŠ¡å¼¹çª— -->
  <view class="add-task-modal" wx:if="{{showAddTaskModal}}">
    <view class="modal-mask" bindtap="hideAddTask"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text>æ·»åŠ ä»»åŠ¡</text>
      </view>
      <view class="modal-body">
        <input class="task-input" 
               placeholder="è¯·è¾“å…¥ä»»åŠ¡å†…å®¹"
               value="{{newTask.title}}"
               bindinput="onTitleInput"/>
        
        <textarea class="task-notes"
                  placeholder="æ·»åŠ å¤‡æ³¨..."
                  value="{{newTask.notes}}"
                  bindinput="onNotesInput"/>
      </view>
      <view class="modal-footer">
        <button class="btn btn-default" bindtap="hideAddTask">å–æ¶ˆ</button>
        <button class="btn btn-primary" bindtap="submitNewTask">ç¡®å®š</button>
      </view>
    </view>
  </view>

  <!-- æ·»åŠ ä»»åŠ¡è¯¦æƒ…æ¨¡æ€æ¡† -->
  <view class="task-detail-modal" wx:if="{{showTaskDetailModal}}">
    <view class="modal-mask" bindtap="hideTaskDetail"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text>ä»»åŠ¡è¯¦æƒ…</text>
        <text class="close-btn" bindtap="hideTaskDetail">Ã—</text>
      </view>
      <view class="modal-body">
        <view class="detail-title {{currentTask.important ? 'important' : ''}}">
          {{currentTask.title}}
        </view>
        
        <view class="detail-section" wx:if="{{currentTask.startTime || currentTask.dueDate}}">
          <view class="section-title">â° æ—¶é—´ä¿¡æ¯</view>
          <view class="time-range">
            <text class="time-emoji">ğŸŸ¢</text>
            <view class="time-container">
              <view class="time-progress" style="width: {{calculateProgress(currentTask.startTime, currentTask.dueDate)}}%"></view>
              <view class="time-text">{{formatDateTime(currentTask.startTime, currentTask.dueDate)}}</view>
            </view>
            <text class="time-emoji">ğŸ”´</text>
          </view>
        </view>
        
        <view class="detail-section" wx:if="{{currentTask.location}}">
          <view class="section-title">ğŸ“ åœ°ç‚¹</view>
          <view class="section-content">{{currentTask.location}}</view>
        </view>
        
        <view class="detail-section" wx:if="{{currentTask.url}}">
          <view class="section-title">ğŸ”— ç›¸å…³é“¾æ¥</view>
          <view class="section-content">{{currentTask.url}}</view>
        </view>
        
        <view class="detail-section" wx:if="{{currentTask.notes}}">
          <view class="section-title">ğŸ“ å¤‡æ³¨</view>
          <rich-text class="section-content" nodes="{{currentTask.notes}}"></rich-text>
        </view>

        <view class="detail-section">
          <view class="section-title">âš™ï¸ å…¶ä»–ä¿¡æ¯</view>
          <view class="section-content">
            <view>åˆ›å»ºæ—¶é—´ï¼š{{formatDateTime(currentTask.createTime)}}</view>
            <view wx:if="{{currentTask.completedTime}}">å®Œæˆæ—¶é—´ï¼š{{formatDateTime(currentTask.completedTime)}}</view>
          </view>
        </view>
      </view>
      <view class="modal-footer">
        <button class="edit-btn" bindtap="editCurrentTask">ç¼–è¾‘</button>
        <button class="delete-btn" bindtap="deleteCurrentTask">åˆ é™¤</button>
      </view>
    </view>
  </view>
</view> 