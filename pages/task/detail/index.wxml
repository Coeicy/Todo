<view class="container">
  <view class="task-detail card" wx:if="{{task}}">
    <!-- ä»»åŠ¡å¤´éƒ¨ -->
    <view class="task-header">
      <view class="status-bar">
        <view class="status {{task.completed ? 'completed' : ''}}" bindtap="toggleStatus">
          <text class="icon">{{task.completed ? 'âœ“' : ''}}</text>
        </view>
        <view class="important {{task.important ? 'active' : ''}}" bindtap="toggleImportant">
          <text class="icon">â­</text>
        </view>
      </view>
      <view class="title">{{task.title}}</view>
    </view>

    <!-- ä»»åŠ¡ä¿¡æ¯ -->
    <view class="task-info">
      <view class="info-item" wx:if="{{task.startTime || task.dueDate}}">
        <view class="label">â° æ—¶é—´</view>
        <view class="value">
          <text wx:if="{{task.startTime}}">{{task.startTime}}</text>
          <text wx:if="{{task.startTime && task.dueDate}}"> - </text>
          <text wx:if="{{task.dueDate}}">{{task.dueDate}}</text>
        </view>
      </view>

      <view class="info-item" wx:if="{{task.location}}">
        <view class="label">ğŸ“ åœ°ç‚¹</view>
        <view class="value">{{task.location}}</view>
      </view>

      <view class="info-item" wx:if="{{task.url}}">
        <view class="label">ğŸ”— é“¾æ¥</view>
        <view class="value link">{{task.url}}</view>
      </view>

      <view class="info-item" wx:if="{{task.notes}}">
        <view class="label">ğŸ“ å¤‡æ³¨</view>
        <view class="value">{{task.notes}}</view>
      </view>

      <view class="info-item">
        <view class="label">âš™ï¸ å…¶ä»–</view>
        <view class="value">
          <view>åˆ›å»ºæ—¶é—´ï¼š{{task.createTime}}</view>
          <view wx:if="{{task.completed}}">å®Œæˆæ—¶é—´ï¼š{{task.completedTime}}</view>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="actions">
      <button class="btn btn-default" bindtap="showEditModal">ç¼–è¾‘</button>
      <button class="btn btn-primary" bindtap="deleteTask">åˆ é™¤</button>
    </view>
  </view>

  <!-- ç¼–è¾‘æ¨¡æ€æ¡† -->
  <view class="modal" wx:if="{{showEditModal}}">
    <view class="modal-mask" bindtap="hideEditModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="title">ç¼–è¾‘ä»»åŠ¡</text>
        <text class="close" bindtap="hideEditModal">Ã—</text>
      </view>

      <view class="modal-body">
        <view class="form-item">
          <input class="input" 
                 placeholder="ä»»åŠ¡æ ‡é¢˜" 
                 value="{{editForm.title}}"
                 data-field="title"
                 bindinput="onInput"/>
        </view>

        <view class="form-item">
          <textarea class="textarea" 
                    placeholder="å¤‡æ³¨" 
                    value="{{editForm.notes}}"
                    data-field="notes"
                    bindinput="onInput"/>
        </view>

        <view class="form-item">
          <picker mode="date" 
                  value="{{editForm.startTime}}"
                  data-field="startTime"
                  bindchange="onInput">
            <view class="picker">
              <text class="label">å¼€å§‹æ—¶é—´ï¼š</text>
              <text class="value">{{editForm.startTime || 'è¯·é€‰æ‹©'}}</text>
            </view>
          </picker>
        </view>

        <view class="form-item">
          <picker mode="date" 
                  value="{{editForm.dueDate}}"
                  data-field="dueDate"
                  bindchange="onInput">
            <view class="picker">
              <text class="label">æˆªæ­¢æ—¶é—´ï¼š</text>
              <text class="value">{{editForm.dueDate || 'è¯·é€‰æ‹©'}}</text>
            </view>
          </picker>
        </view>

        <view class="form-item">
          <input class="input" 
                 placeholder="åœ°ç‚¹" 
                 value="{{editForm.location}}"
                 data-field="location"
                 bindinput="onInput"/>
        </view>

        <view class="form-item">
          <input class="input" 
                 placeholder="ç›¸å…³é“¾æ¥" 
                 value="{{editForm.url}}"
                 data-field="url"
                 bindinput="onInput"/>
        </view>

        <view class="form-item">
          <switch checked="{{editForm.important}}" 
                  bindchange="toggleImportant"/>
          <text class="switch-label">æ ‡è®°ä¸ºé‡è¦</text>
        </view>
      </view>

      <view class="modal-footer">
        <button class="btn btn-default" bindtap="hideEditModal">å–æ¶ˆ</button>
        <button class="btn btn-primary" bindtap="updateTask">ä¿å­˜</button>
      </view>
    </view>
  </view>
</view> 